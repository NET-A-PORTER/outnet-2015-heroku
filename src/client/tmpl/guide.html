<!DOCTYPE html>
<html ng-app="app" ng-controller="GuideCtrl">
<head>
	<title>Preston</title>
	<link rel="stylesheet" href="/js/highlightjs.css">
	<link rel="stylesheet" ng-repeat="element in preston.elements" ng-href=":: element.getAssetPath('css', 'style.css') ::">
	<link rel="stylesheet" ng-repeat="element in style.elements" ng-href=":: element.getAssetPath('css', 'style.css') ::">
	<link rel="stylesheet" ng-repeat="element in style.elements" ng-if="element.assets['override.scss']" ng-href=":: element.getAssetPath('css', 'override.css') ::">
	<style>
	pre ***REMOVED*** white-space: pre-wrap; ***REMOVED***
	</style>
</head>
<body>
	<div class="preston-guide-heading" style="margin-bottom: 0;">
		<div class="preston-container">
			<h1 ng-bind="style.title + ' Style Guide'"></h1>
		</div>
	</div>
	<div class="preston-container" style="padding:0;">
		<div class="preston-element" ng-repeat="element in elements" ng-class="'preston-element-' + element.name" style="background: #fff; display: table; width: 100%;">
			<div class="preston-element-examples" style="display:table-cell;padding: 10px;vertical-align:top;">
				<h2 class="preston-element-title" ng-bind="element.name"></h2>
				<div ng-repeat="view in element.views | filter:view.title='Markup'" ng-bind-html="view.contents"></div>
			</div>
			<div style="  border-left: #959FA3 1px solid; background: #CDD5D8;width: 600px;display: table-cell;padding: 20px;">
				<div class="preston-pill"
					ng-repeat="view in element.views track by $index"
					ng-bind="view.title"
					ng-class="***REMOVED*** 'preston-pill-selected': $index == element.selected ***REMOVED***"
					ng-click="element.selected = $index"
					ng-hide="view.title == 'Markup'"></div>
				<div ng-repeat="view in element.views track by $index" ng-hide="view.title == 'Markup' || $index != element.selected" >
					<div ng-bind-html="view.contents"></div>
				</div>
			</div>
		</div>
	</div>
	<script src="/js/angular.js"></script>
	<script src="/js/angular-sanitize.js"></script>
	<script src="/js/highlight.js"></script>
	<script>
	var parentScope = window.parent.angular.element(window.frameElement).scope();
	angular
		.module('app', ['ngSanitize'])
		.config(function($interpolateProvider) ***REMOVED***
			// stop conflicting with handlebars
			$interpolateProvider.startSymbol('::');
			$interpolateProvider.endSymbol('::');
		***REMOVED***)
		.service('ElementViewService', function($sce) ***REMOVED***
			var formatForDisplay = function(content) ***REMOVED***
				return '<pre><code>' + content + '</code></pre>';
			***REMOVED***;

			var ElementViewService = function(baseElement) ***REMOVED***
				this.base = baseElement;
				this.name = this.base.name;
				this.views = this.createViews();
				this.selected = 0;
				return this;
			***REMOVED***;
			ElementViewService.prototype = ***REMOVED***
				addView: function(title, content) ***REMOVED***
					this.views.push(***REMOVED***
						title: title,
						contents: $sce.trustAsHtml(content)
					***REMOVED***);
				***REMOVED***,
				createViews: function() ***REMOVED***
					this.views = [];
					var baseAssets = this.base.assets;
					for (var name in baseAssets) ***REMOVED***
						var asset = baseAssets[name];
						var extenstion = name.split('.').pop();
						switch (extenstion) ***REMOVED***
							case 'hbs':
								this.addView('HTML', formatForDisplay(asset.html));
								this.addView('Markup', asset.markup);
								break;
							case 'scss':
								this.addView('CSS', formatForDisplay(asset.compiled));
								this.addView('SASS', formatForDisplay(asset.source));
								break;
						***REMOVED***
					***REMOVED***
					return this.views;
				***REMOVED***
			***REMOVED***;

			return ElementViewService;
		***REMOVED***)
		.controller('GuideCtrl', function($scope, ElementViewService) ***REMOVED***
			var Style = parentScope.Style;
			var $state = parentScope.$state;
			var currentStyle = $state.params.name;

			$scope.preston = new Style('preston', ***REMOVED*** shallow: true ***REMOVED***);
			$scope.style = new Style(currentStyle);

			parentScope.$on('style.load', function(e, style) ***REMOVED***
				// don't map elements when preston styles loaded
				if (style.name !== 'preston') ***REMOVED***
					$scope.elements = $scope.style.elements.map(function(element) ***REMOVED***
						return new ElementViewService(element);
					***REMOVED***);

					// TODO: make this a directive
					window.setTimeout(function() ***REMOVED***
						hljs.configure(***REMOVED***
							languages: ['html', 'css', 'scss']
						***REMOVED***);
						[].forEach.call(document.querySelectorAll('code'), function(block) ***REMOVED***
							hljs.highlightBlock(block);
						***REMOVED***);
					***REMOVED***, 100);
				***REMOVED***
				// force scope update on load
				$scope.$digest();
			***REMOVED***);
		***REMOVED***);
	</script>
</body>
</html>
